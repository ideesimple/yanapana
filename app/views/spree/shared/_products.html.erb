
<%
  paginated_products = @searcher.retrieve_products if params.key?(:keywords)
  paginated_products ||= products
%>
<% active_prods = Array.new %>
<% products.each do |product| %>
  <% if Spree::Config[:show_zero_stock_products] || product.has_stock? %>
    <% active_prods << product %>
  <% end %>
<% end %>

<% if active_prods.empty? %>
  <%= t(:no_products_found) %>
<% elsif params.key?(:keywords) %>
  <%= t(:search_results, :keywords => h(params[:keywords]), :count => active_prods.count) %>
<% else %>
  <% t(:product_results, :count => active_prods.count) %>
<% end %>

<% if products.any? %>
  <section>
    <!--Product List Starts-->
    <div class="products_list products_slider">
      <h2 class="sub_title">Products</h2>
      <% reset_cycle('default') %>
    <ul id="first-carousel" class="first-and-second-carousel jcarousel-skin-tango">
      <% products.each do |product| %>
        <% if product.on_display? %>
         <li>
           <div class="product_img_container">
             <%= link_to product_image(product, :itemprop => "image"), product, :itemprop => 'url', :class=>"product_image" %>
             <div class="price_info">
              <a><button type="button" title="" class="price_add"><span class="pr_price"><%= product.display_price %></span><span class="pr_add"><span>Add to Cart</span></button></a>
              </div>
            </div>
            <div class="product_info">
              <h3><%= link_to truncate(product.name, :length => 50), product, :class => 'info', :itemprop => "name", :title => product.name %></h3>
              <small><%= product.description %></small>
            </div>
          </li>
        <% end %>
      <% end  %>
    </ul>
    <% reset_cycle("classes") %>
      </div>
  </section>
<% end %>
<%= form_for :order, :url => populate_orders_path, :remote => true do |f| %>

<% end %>

<% if paginated_products.respond_to?(:num_pages) %>
  <%= paginate paginated_products %>
<% end %>
